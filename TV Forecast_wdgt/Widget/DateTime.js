var continents =
[
{
    continent: 'South America',
    cities:
    [
        { city:'Asunción',       timezone:'America/Asuncion' },
    	{ city:'Bogotá',         timezone:'America/Bogota' },
    	{ city:'Brasília',       timezone:'Brazil/East' },
    	{ city:'Buenos Aires',   timezone:'America/Buenos_Aires' },
    	{ city:'Caracas',        timezone:'America/Caracas' },
    	{ city:'Cayenne',        timezone:'America/Cayenne' },
    	{ city:'Georgetown',     timezone:'America/Guyana' },
    	{ city:'La Paz',         timezone:'America/La_Paz' },
    	{ city:'Lima',           timezone:'America/Lima' },
    	{ city:'Montevideo',     timezone:'America/Montevideo' },
    	{ city:'Paramaribo',     timezone:'America/Paramaribo' },
    	{ city:'Quito',          timezone:'America/Guayaquil' },
    	{ city:'Recife',         timezone:'America/Recife' },
    	{ city:'Rio de Janeiro', timezone:'Brazil/East' },
    	{ city:'San Juan',       timezone:'America/Puerto_Rico' },
    	{ city:'Santiago',       timezone:'America/Santiago' },
    	{ city:'São Paulo',      timezone:'America/Sao_Paulo' }
    ]
},
{
    continent: 'Pacific',
    cities:
    [
        { city:'Guam',        timezone:'Pacific/Guam' },
	    { city:'Honolulu',    timezone:'Pacific/Honolulu' },
	    { city:'Nouméa',      timezone:'Pacific/Noumea' },
	    { city:'Pago Pago',   timezone:'Pacific/Pago_Pago' },
	    { city:'Wellington',  timezone:'Pacific/Auckland' }
    ]
},
{
    continent: 'Atlantic',
    cities:
    [
        { city:'Grytviken',     timezone:'Atlantic/South_Georgia' },
	    { city:'Ponta Delgada', timezone:'Atlantic/Azores' },
	    { city:'Reykjavík',     timezone:'Atlantic/Reykjavik' }
    ]
},
{
    continent: 'Europe',
    cities:
    [
        { city:'Amsterdam', timezone:'Europe/Amsterdam' },
    	{ city:'Athens', timezone:'Europe/Athens' },
    	{ city:'Belgrade', timezone:'Europe/Belgrade' },
    	{ city:'Berlin', timezone:'Europe/Berlin' },
    	{ city:'Brussels', timezone:'Europe/Brussels' },
    	{ city:'Bucharest', timezone:'Europe/Bucharest' },
    	{ city:'Budapest', timezone:'Europe/Budapest' },
    	{ city:'Cardiff', timezone:'Europe/London' },
    	{ city:'Copenhagen', timezone:'Europe/Copenhagen' },
    	{ city:'Cork', timezone:'Europe/Dublin' },
    	{ city:'Dublin', timezone:'Europe/Dublin' },
    	{ city:'Edinburgh', timezone:'Europe/London' },
    	{ city:'Geneva', timezone:'Europe/Zurich' },
    	{ city:'Helsinki', timezone:'Europe/Helsinki' },
    	{ city:'Istanbul', timezone:'Asia/Istanbul' },
    	{ city:'Kiev', timezone:'Europe/Kiev' },
    	{ city:'Lisbon', timezone:'Europe/Lisbon' },
    	{ city:'Ljubljana', timezone:'Europe/Ljubljana' },
    	{ city:'London', timezone:'Europe/London' },
    	{ city:'Madrid', timezone:'Europe/Madrid' },
    	{ city:'Moscow', timezone:'Europe/Moscow' },
    	{ city:'Munich', timezone:'Europe/Berlin' },
    	{ city:'Oslo', timezone:'Europe/Oslo' },
    	{ city:'Paris', timezone:'Europe/Paris' },
    	{ city:'Prague', timezone:'Europe/Prague' },
    	{ city:'Roma (Rome)', timezone:'Europe/Rome' },
    	{ city:'Sofia', timezone:'Europe/Sofia' },
    	{ city:'St. Petersburg', timezone:'Europe/Moscow' },
    	{ city:'Stockholm', timezone:'Europe/Stockholm' },
    	{ city:'Vienna', timezone:'Europe/Vienna' },
    	{ city:'Volgograd', timezone:'Europe/Moscow' },
    	{ city:'Warsaw', timezone:'Europe/Warsaw' },
    	{ city:'Zagreb', timezone:'Europe/Zagreb' },
    	{ city:'Zurich', timezone:'Europe/Zurich' }
    ]
},
{
    continent: 'Africa',
    cities:
    [
        { city:'Accra', timezone:'Africa/Accra' },
    	{ city:'Addis Ababa', timezone:'Africa/Addis_Ababa' },
    	{ city:'Algiers', timezone:'Africa/Algiers' },
    	{ city:'Asmera', timezone:'Africa/Asmera' },
    	{ city:'Bamako', timezone:'Africa/Bamako' },
    	{ city:'Bangui', timezone:'Africa/Bangui' },
    	{ city:'Cairo', timezone:'Africa/Cairo' },
    	{ city:'Cape Town', timezone:'Africa/Johannesburg' },
    	{ city:'Conakry', timezone:'Africa/Conakry' },
    	{ city:'Dakar', timezone:'Africa/Dakar' },
    	{ city:'Dar es Salaam', timezone:'Africa/Dar_es_Salaam' },
    	{ city:'Djibouti', timezone:'Africa/Djibouti' },
    	{ city:'Douala', timezone:'Africa/Douala' },
    	{ city:'Freetown', timezone:'Africa/Freetown' },
    	{ city:'Harare', timezone:'Africa/Harare' },
    	{ city:'Kampala', timezone:'Africa/Kampala' },
    	{ city:'Khartoum', timezone:'Africa/Khartoum' },
    	{ city:'Kinshasa', timezone:'Africa/Kinshasa' },
    	{ city:'Lagos', timezone:'Africa/Lagos' },
    	{ city:'Luanda', timezone:'Africa/Luanda' },
    	{ city:'Lusaka', timezone:'Africa/Lusaka' },
    	{ city:'Maputo', timezone:'Africa/Maputo' },
    	{ city:'Mogadishu', timezone:'Africa/Mogadishu' },
    	{ city:'Monrovia', timezone:'Africa/Monrovia' },
    	{ city:'Nairobi', timezone:'Africa/Nairobi' },
    	{ city:'Ndjamena', timezone:'Africa/Ndjamena' },
    	{ city:'Nouakchott', timezone:'Africa/Nouakchott' },
    	{ city:'Ouagadougou', timezone:'Africa/Ouagadougou' },
    	{ city:'Rabat', timezone:'Africa/Rabat' },
    	{ city:'Tripoli', timezone:'Africa/Tripoli' },
    	{ city:'Tunis', timezone:'Africa/Tunis' }
	]
},
{
    continent: 'North America',
    cities:
    [
        {city:'Adak', timezone:'America/Adak'},
    	{city:'Anchorage', timezone:'America/Anchorage'},
    	{city:'Atlanta', timezone:'US/Eastern'},
    	{city:'Austin', timezone:'US/Central'},
    	{city:'Boston', timezone:'US/Eastern'},
    	{city:'Calgary', timezone:'Canada/Mountain'},
    	{city:'Chicago', timezone:'America/Chicago'},
    	{city:'Columbus', timezone:'US/Eastern'},
    	{city:'Cupertino', timezone:'US/Pacific'},
    	{city:'Dallas', timezone:'US/Central'},
    	{city:'Denver', timezone:'America/Denver'},
    	{city:'Detroit', timezone:'America/Detroit'},
    	{city:'Guatemala', timezone:'America/Guatemala'},
    	{city:'Halifax', timezone:'Canada/Atlantic'},
    	{city:'Havana', timezone:'America/Havana'},
    	{city:'Indianapolis', timezone:'America/Indianapolis'},
    	{city:'Knoxville', timezone:'US/Eastern'},
    	{city:'Los Angeles', timezone:'America/Los_Angeles'},
    	{city:'Managua', timezone:'America/Managua'},
    	{city:'Manchester', timezone:'US/Eastern'},
    	{city:'Memphis', timezone:'US/Central'},
    	{city:'Mexico City', timezone:'America/Mexico_City'},
    	{city:'Miami', timezone:'US/Eastern'},
    	{city:'Minneapolis', timezone:'US/Central'},
    	{city:'Montréal', timezone:'America/Montreal'},
    	{city:'New York', timezone:'America/New_York'},
    	{city:'Nuuk', timezone:'America/Godthab'},
    	{city:'Ottawa', timezone:'Canada/Eastern'},
    	{city:'Panama', timezone:'America/Panama'},
    	{city:'Philadelphia', timezone:'US/Eastern'},
    	{city:'Phoenix', timezone:'America/Phoenix'},
    	{city:'Port-au-Prince', timezone:'America/Port-au-Prince'},
    	{city:'Portland', timezone:'US/Pacific'},
    	{city:'Regina', timezone:'Canada/Saskatchewan'},
    	{city:'Salt Lake City', timezone:'US/Mountain'},
    	{city:'San Diego', timezone:'US/Pacific'},
    	{city:'San Francisco', timezone:'US/Pacific'},
    	{city:'San José', timezone:'America/Costa_Rica'},
    	{city:'San Salvador', timezone:'America/El_Salvador'},
    	{city:'Santo Domingo', timezone:'America/Santo_Domingo'},
    	{city:'Seattle', timezone:'US/Pacific'},
    	{city:'St. John\'s', timezone:'Canada/Newfoundland'},
    	{city:'St. Louis', timezone:'US/Central'},
    	{city:'Tegucigalpa', timezone:'America/Tegucigalpa'},
    	{city:'Toronto', timezone:'Canada/Eastern'},
    	{city:'Vancouver', timezone:'America/Vancouver'},
    	{city:'Washington, D.C.', timezone:'US/Eastern'},
    	{city:'Winnipeg', timezone:'America/Winnipeg'}
    ]
},
{
    continent: 'Asia',
    cities:
    [
        {city:'Abu Dhabi', timezone:'Asia/Dubai'},
    	{city:'Amman', timezone:'Asia/Amman'},
    	{city:'Anadyr', timezone:'Asia/Anadyr'},
    	{city:'Ankara', timezone:'Europe/Istanbul'},
    	{city:'Antananarivo', timezone:'Indian/Antananarivo'},
    	{city:'Baghdad', timezone:'Asia/Baghdad'},
    	{city:'Bangkok', timezone:'Asia/Bangkok'},
    	{city:'Beijing', timezone:'Asia/Shanghai'},
    	{city:'Beirut', timezone:'Asia/Beirut'},
    	{city:'Canton', timezone:'Asia/Shanghai'},
    	{city:'Chennai (Madras)', timezone:'Asia/Calcutta'},
    	{city:'Colombo', timezone:'Asia/Colombo'},
    	{city:'Dhaka', timezone:'Asia/Dhaka'},
    	{city:'Damascus', timezone:'Asia/Damascus'},
    	{city:'Doha', timezone:'Asia/Qatar'},
    	{city:'Hanoi', timezone:'Asia/Saigon'},
    	{city:'Hong Kong', timezone:'Asia/Hong_Kong'},
    	{city:'Islamabad', timezone:'Asia/Karachi'},
    	{city:'Jakarta', timezone:'Asia/Jakarta'},
    	{city:'Jerusalem', timezone:'Asia/Jerusalem'},
    	{city:'Kabul', timezone:'Asia/Kabul'},
    	{city:'Katmandu', timezone:'Asia/Katmandu'},
    	{city:'Kolkata (Calcutta)', timezone:'Asia/Calcutta'},
    	{city:'Krasnoyarsk', timezone:'Asia/Krasnoyarsk'},
    	{city:'Kuala Lumpur', timezone:'Asia/Kuala_Lumpur'},
    	{city:'Kuwait', timezone:'Asia/Kuwait'},
    	{city:'Magadan', timezone:'Asia/Magadan'},
    	{city:'Male', timezone:'Indian/Maldives'},
    	{city:'Manama', timezone:'Asia/Bahrain'},
    	{city:'Manila', timezone:'Asia/Manila'},
    	{city:'Mecca', timezone:'Asia/Riyadh'},
    	{city:'Mumbai (Bombay)', timezone:'Asia/Calcutta'},
    	{city:'Muscat', timezone:'Asia/Muscat'},
    	{city:'New Delhi', timezone:'Asia/Calcutta'},
    	{city:'Novosibirsk', timezone:'Asia/Novosibirsk'},
    	{city:'Omsk', timezone:'Asia/Omsk'},
    	{city:'Osaka', timezone:'Japan'},
    	{city:'Phnom Penh', timezone:'Asia/Phnom_Penh'},
    	{city:'Port Louis', timezone:'Indian/Mauritius'},
    	{city:'Pyongyang', timezone:'Asia/Pyongyang'},
    	{city:'Rangoon', timezone:'Asia/Rangoon'},
    	{city:'Riyadh', timezone:'Asia/Riyadh'},
    	{city:'Sanaa', timezone:'Asia/Aden'},
    	{city:'Seoul', timezone:'Asia/Seoul'},
    	{city:'Shanghai', timezone:'Asia/Shanghai'},
    	{city:'Singapore', timezone:'Asia/Singapore'},
    	{city:'Taipei', timezone:'Asia/Taipei'},
    	{city:'Tashkent', timezone:'Asia/Tashkent'},
    	{city:'Tehran', timezone:'Asia/Tehran'},
    	{city:'Thanh Pho Ho Chi Minh', timezone:'Asia/Saigon'},
    	{city:'Tientsin', timezone:'Asia/Shanghai'},
    	{city:'Tokyo', timezone:'Japan'},
    	{city:'Ulaanbaatar', timezone:'Asia/Ulaanbaatar'},
    	{city:'Victoria', timezone:'Indian/Mahe'},
    	{city:'Vladivostok', timezone:'Asia/Vladivostok'},
    	{city:'Yakutsk', timezone:'Asia/Yakutsk'},
    	{city:'Yekaterinburg', timezone:'Asia/Yekaterinburg'}
    ]
},
{
    continent: 'Australia',
    cities:
    [
        {city:'Adelaide', timezone:'Australia/Adelaide'},
    	{city:'Brisbane', timezone:'Australia/Brisbane'},
    	{city:'Canberra', timezone:'Australia/Canberra'},
    	{city:'Darwin', timezone:'Australia/Darwin'},
    	{city:'Hobart', timezone:'Australia/Hobart'},
    	{city:'Melbourne', timezone:'Australia/Melbourne'},
    	{city:'Perth', timezone:'Australia/Perth'},
    	{city:'Sydney', timezone:'Australia/Sydney'}
    ]
}
]

// Returns the current time in the specified timezone or in your current
// timezone if one is not specified.
function getTime(timezone)
{
    var tz_env_str = "/usr/bin/env TZ=";
    var date_str   = "/bin/date +'%B, %d %Y %H:%M:%S'";
    var time;
   
    if (timezone)
    {
        time = widget.system(tz_env_str + 
                             timezone + 
                             " " + 
                             date_str, 
                             null).outputString;
    }
    else
    {
        time = widget.system(date_str, null).outputString;
    }
    
    return Date.parse(time);
}

// Returns the time zone difference (in minutes) between any two zoneinfo 
// database entries. A blank parameter will be treated as your current timezone.
function timezoneDifference(lhs, rhs)
{   
    lhs_time = getTime(lhs);
    rhs_time = getTime(rhs);
    
    var difference = lhs_time - rhs_time;
        
    // difference in minutes
    difference = difference / 1000 / 60;
    
    // times will usually be the same but may sometimes vary but a second
    // so ceil the result to the nearest minute
    difference = Math.ceil(difference);
    
    return difference;
}

// Returns the 3 character abbreviation of a month (0 - 11)
function monthToShortString(i)
{
    switch (i)
    {
        case 0:  return "Jan";
        case 1:  return "Feb";
        case 2:  return "Mar";
        case 3:  return "Apr";
        case 4:  return "May";
        case 5:  return "Jun";
        case 6:  return "Jul";
        case 7:  return "Aug";
        case 8:  return "Sep";
        case 9:  return "Oct";
        case 10: return "Nov";
        case 11: return "Dec";
    }
    
    return null;
}

// Returns the 3 character abbreviation of a day of the week (0 - 6)
function dayToShortString(i)
{
    switch (i)
    {
        case 0: return "Sun";
        case 1: return "Mon";
        case 2: return "Tue";
        case 3: return "Wed";
        case 4: return "Thu";
        case 5: return "Fri";
        case 6: return "Sat";
    }

    return null;
}

// Returns a capitalized string of a month (0 - 11)
function monthToString(i)
{
    switch (i)
    {
        case 0:  return "January";
        case 1:  return "February";    
        case 2:  return "March";
        case 3:  return "April";
        case 4:  return "May";
        case 5:  return "June";
        case 6:  return "July";
        case 7:  return "August";
        case 8:  return "September";
        case 9:  return "October";
        case 10: return "November";
        case 11: return "December";
    }
    
    return null;
}

// Returns the month (0 - 11) represented by a capitalized string
function stringToMonth(str)
{
    switch (str)
    {
        case "January":   return 0;
        case "February":  return 1;
        case "March":     return 2;
        case "April":     return 3;
        case "May":       return 4;
        case "June":      return 5;
        case "July":      return 6;
        case "August":    return 7;
        case "September": return 8;
        case "October":   return 9;
        case "November":  return 10;
        case "December":  return 11;
    }
    
    return null;
}

// Returns the number of days between lhs and rhs
function daysBetween(lhs, rhs)
{
    var ms_in_day = 86400000;
	
    var lhs_midnight = 
        new Date(lhs.getYear(),
                 lhs.getMonth(),
                 lhs.getDate(),
                 0,
                 0,
                 0);

    var rhs_midnight = 
        new Date(rhs.getYear(),
                 rhs.getMonth(),
                 rhs.getDate(),
                 0,
                 0,
                 0);

	var days = (rhs_midnight - lhs_midnight) / ms_in_day;
	
	return Math.round(days);
}

// Returns a pretty formatted date string
function dateToString(date)
{
    var today = new Date();
    
    formatted_date =
        dayToShortString(date.getDay()) + ", " +     
        monthToShortString(date.getMonth()) + " " + date.getDate();
    
    if (date.getFullYear() != new Date().getFullYear())
    {
        formatted_date += ", " + date.getFullYear();
    }
	
	return formatted_date;
}